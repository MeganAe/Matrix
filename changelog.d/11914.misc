Various refactors to the typing notifications code.