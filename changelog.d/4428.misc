Move SRV logic into the Agent layer
