Simplifications and comments in do_auth.
