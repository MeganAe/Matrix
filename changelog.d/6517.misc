Port some of FederationHandler to async/await.