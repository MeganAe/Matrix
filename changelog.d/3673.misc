Refactor state module to support multiple room versions
