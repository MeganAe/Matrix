Refactor database transaction for query users' devices to reduce database pool contention.
