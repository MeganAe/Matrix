Various cleanups in the federation client code
