Apply some internal fixes to the `HomeServer` class to make it's code more idiomatic and statically-verifiable.