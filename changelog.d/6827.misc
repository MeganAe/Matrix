Refactoring work in preparation for changing the event redaction algorithm.
