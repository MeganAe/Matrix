Port much of `synapse.handlers.federation` to async/await.
