Fix bug where we might not correctly calculate the current state for rooms with multiple extremities.
