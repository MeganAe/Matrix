Refactor user directory tests in preparation for upcoming changes.
