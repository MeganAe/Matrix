HTTP tests have been refactored to contain less boilerplate.
