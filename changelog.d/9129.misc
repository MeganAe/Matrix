Various improvements to the federation client.
